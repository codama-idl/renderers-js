/**
 * This code was AUTOGENERATED using the Codama library.
 * Please DO NOT EDIT THIS FILE, instead use visitors
 * to add features, then rerun Codama to update it.
 *
 * @see https://github.com/codama-idl/codama
 */

import {
    assertIsInstructionWithAccounts,
    containsBytes,
    getU32Encoder,
    SOLANA_ERROR__PROGRAM_CLIENTS__FAILED_TO_IDENTIFY_INSTRUCTION,
    SOLANA_ERROR__PROGRAM_CLIENTS__UNRECOGNIZED_INSTRUCTION_TYPE,
    SolanaError,
    type Address,
    type Instruction,
    type InstructionWithData,
    type ReadonlyUint8Array,
} from '@solana/kit';
import { parseCreateAccountInstruction, type ParsedCreateAccountInstruction } from '../instructions';

export const SYSTEM_PROGRAM_ADDRESS = '11111111111111111111111111111111' as Address<'11111111111111111111111111111111'>;

export enum SystemInstruction {
    CreateAccount,
}

export function identifySystemInstruction(
    instruction: { data: ReadonlyUint8Array } | ReadonlyUint8Array,
): SystemInstruction {
    const data = 'data' in instruction ? instruction.data : instruction;
    if (containsBytes(data, getU32Encoder().encode(0), 0)) {
        return SystemInstruction.CreateAccount;
    }
    throw new SolanaError(SOLANA_ERROR__PROGRAM_CLIENTS__FAILED_TO_IDENTIFY_INSTRUCTION, {
        instructionData: data,
        programName: 'system',
    });
}

export type ParsedSystemInstruction<TProgram extends string = '11111111111111111111111111111111'> = {
    instructionType: SystemInstruction.CreateAccount;
} & ParsedCreateAccountInstruction<TProgram>;

export function parseSystemInstruction<TProgram extends string>(
    instruction: Instruction<TProgram> & InstructionWithData<ReadonlyUint8Array>,
): ParsedSystemInstruction<TProgram> {
    const instructionType = identifySystemInstruction(instruction);
    switch (instructionType) {
        case SystemInstruction.CreateAccount: {
            assertIsInstructionWithAccounts(instruction);
            return { instructionType: SystemInstruction.CreateAccount, ...parseCreateAccountInstruction(instruction) };
        }
        default:
            throw new SolanaError(SOLANA_ERROR__PROGRAM_CLIENTS__UNRECOGNIZED_INSTRUCTION_TYPE, {
                instructionType: instructionType as string,
                programName: 'system',
            });
    }
}
